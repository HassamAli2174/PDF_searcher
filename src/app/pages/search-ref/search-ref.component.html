<app-page-layout title="Search Documents by Reference">
    <mat-card class="search-card">
        <h2>Find Documents</h2>
        <p class="subtitle">Enter Master and Event Reference to view uploaded documents.</p>

        <!-- Master Reference -->
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Master Reference</mat-label>
            <input matInput [(ngModel)]="masterRef" (keyup.enter)="onSearch()" />
        </mat-form-field>

        <!-- Event Reference -->
        <mat-form-field appearance="outline" class="full-width">
            <mat-label>Event Reference</mat-label>
            <input matInput [(ngModel)]="eventRef" (keyup.enter)="onSearch()" />
        </mat-form-field>

        <button mat-raised-button color="accent" class="search-btn" (click)="onSearch()">
            Search
        </button>

        <!-- Loading Spinner -->
        <div *ngIf="loading" class="spinner-container">
            <mat-spinner diameter="40"></mat-spinner>
        </div>

        <!-- Results -->
        <mat-card *ngIf="documents.length > 0 && !loading" class="result-card">
            <h3 class="title">Documents Found</h3>

            <div class="table-container">
                <table mat-table [dataSource]="documents" class="custom-table">

                    <!-- Doc ID For downloading-->
                    <!-- <ng-container matColumnDef="docid">
                              <th mat-header-cell *matHeaderCellDef>Doc ID</th>
                                <td mat-cell *matCellDef="let doc">
                                        <span class="doc-link" (click)="openDocument(doc.docid)">
                                                     {{ doc.docid }}
                                                    </span>
                                                </td> -->

                    <!-- Doc ID -->
                    <ng-container matColumnDef="docid">
                        <th mat-header-cell *matHeaderCellDef> Doc ID </th>
                        <td mat-cell *matCellDef="let element">
                            <span class="doc-link" (click)="openDocument(element.docid)">
                                {{ element.docid }}
                            </span>
                        </td>
                    </ng-container>

                    <!-- Filename -->
                    <ng-container matColumnDef="filename">
                        <th mat-header-cell *matHeaderCellDef> Filename </th>
                        <td mat-cell *matCellDef="let doc">{{ doc.filename }}</td>
                    </ng-container>

                    <!-- Document Type -->
                    <ng-container matColumnDef="documentType">
                        <th mat-header-cell *matHeaderCellDef> Document Type </th>
                        <td mat-cell *matCellDef="let doc">{{ doc.documentType }}</td>
                    </ng-container>

                    <!-- Description -->
                    <ng-container matColumnDef="description">
                        <th mat-header-cell *matHeaderCellDef> Description </th>
                        <td mat-cell *matCellDef="let doc">
                            {{ doc.description || '-' }}
                        </td>
                    </ng-container>

                    <!-- Document Category -->
                    <ng-container matColumnDef="docdoccat">
                        <th mat-header-cell *matHeaderCellDef> Category </th>
                        <td mat-cell *matCellDef="let doc">
                            {{ doc.docdoccat }}
                        </td>
                    </ng-container>

                    <!-- Document Type (Business Type) -->
                    <ng-container matColumnDef="doctype">
                        <th mat-header-cell *matHeaderCellDef> Type </th>
                        <td mat-cell *matCellDef="let doc">
                            {{ doc.doctype }}
                        </td>
                    </ng-container>


                    <!-- Rows -->
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

                </table>
            </div>
        </mat-card>

        <div *ngIf="!loading && documents.length === 0 && searched">
            <p>No documents found for the given references.</p>
        </div>
    </mat-card>
</app-page-layout>